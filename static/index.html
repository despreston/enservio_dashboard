<!DOCTYPE html>
<html>
<head>
	<title>Enservio Development Dashboard</title>
	<link rel='stylesheet' href='/resources/bootstrap.min.css'>
</head>
<body>
	<ul class='nav nav-tabs'>
		<li role='presentation' class='dropdown'>
			<a id='devdrop' href='#' class='dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' role='button' area-expanded='false'>Dev<span class='caret'></span></a>
			<ul id='dev' class='dropdown-menu' role='menu' aria-labelledby='devdrop'>
				<li role='presentation'>
					<a id='dev02' data-env='dev' role='menuitem' tabindex='-1' href='#dev02'>02</a>
				</li>
				<li role='presentation'>
					<a id='dev03' data-env='dev' role='menuitem' tabindex='-1' href='#dev03'>03</a>
				</li>
			</ul>
		</li>
		<li role='presentation' class='dropdown'>
			<a id='qadrop' href='#' class='dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' role='button' area-expanded='false'>QA<span class='caret'></span></a>
			<ul class='dropdown-menu' role='menu' aria-labelledby='qadrop'>
				<li role='presentation'>
					<a id='qa11' data-env='qa' role='menuitem' tabindex='-1' href='#qa11'>11</a>
				</li>
				<li role='presentation'>
					<a id='qa32' data-env='qa' role='menuitem' tabindex='-1' href='#qa32'>32</a>
				</li>
			</ul>
		</li>
		<li role='presentation'><a href='#uat'>UAT</a></li>
		<li role='presentation'><a href='#prod'>Prod</a></li>
	</ul>

	<div class='accordion' id='accordion' role='tablist' aria-multiselectable='true'><div class='content'></div></div>

<script src='socket.io.js'></script>
<script src="/resources/jquery-2.1.3.min.js"></script>
<script src='/resources/bootstrap.min.js'></script>
<script>
var socket = io();

$(document).ready(function(){
	$('.dropdown-menu li a').click(function(event) {
		var selected = $(this).attr('id');
		var env = $(this).attr('data-env');
		$('.content').replaceWith('<div class="content"> </div>');
		socket.emit('getServerInfo', { server: selected, environment: env});
	});

	var pickData = function(data) {
		var body = '';
		$.each(data, function(key, value) {
			body += '<strong>' + key + '</strong>: ' + value + '<br />';
		});
		return body;
	}

	socket.on('servers_update', function(data) {
		var content = '';

		if (data.hasOwnProperty('error')) {
			$('.content').append('<h4>'+data.error+'</h4>');
			return;
		}

		$.each(data, function(key, value) {
			var bodyData = pickData(value.build_info);
			content += "<div class='content'>"+
						"<div class='panel panel-default'>" +
							"<div class='panel-heading' role='tab' id='"+key+"'>" +
								"<h4 class='panel-title'>" +
									"<a class='collapsed' data-toggle='collapse' data-parent='#accordion' href='#collapse"+key+"' aria-expanded='false' aria-controls='collapse"+key+"'>" +
									value.build_info.project_name +
									"</a>" +
								"</h4>" +
							"</div>" +
							"<div id='collapse"+key+"' class='panel-collapse collapse' role='tabpanel' aria-labelledby='"+key+"'>" +
								"<div class='panel-body'>" +
								 bodyData+
								"</div>"+
							"</div>" +
						"</div>"+
						"</div>";
		});
		$('.content').append(content);
	});
});
</script>
</body>
</html>